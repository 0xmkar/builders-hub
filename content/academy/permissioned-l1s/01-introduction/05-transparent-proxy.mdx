---
title: Transparent Proxy
description: In-depth guide of the Transparent Proxy smart contract structure and flows
updated: 2025-01-10
authors: [nicolasarnedo]
icon: BookOpen
---

## Contract Structure

The Transparent Proxy pattern consists of three main contracts that work together to provide secure upgradeability while preventing function selector clashes.

<Mermaid
  chart="
classDiagram
    class TransparentUpgradeableProxy {
        -address _admin (immutable)
        +constructor(logic, initialOwner, data)
        +_fallback()
        +_dispatchUpgradeToAndCall()
    }

    class ERC1967Proxy {
        +constructor(implementation, data)
        +_implementation()
    }

    class ProxyAdmin {
        +upgradeAndCall(proxy, implementation, data)
        +owner()
    }

    class Ownable {
        +onlyOwner()
        +transferOwnership()
    }

    TransparentUpgradeableProxy --> ERC1967Proxy
    TransparentUpgradeableProxy --> ProxyAdmin : creates and manages
    ProxyAdmin --> Ownable
"
/>

**Key Components:**
- **TransparentUpgradeableProxy**: Main proxy with immutable admin address for gas efficiency
- **ProxyAdmin**: Administrative contract managing upgrades through ownership transfer capability
- **Implementation**: Contains actual business logic, upgradeable via ProxyAdmin

## Admin Flow

Admins can only call upgrade functions. All other calls are blocked to prevent selector clashes.

<Mermaid
  chart="
sequenceDiagram
    participant Admin
    participant ProxyAdmin
    participant TransparentProxy
    participant NewImplementation

    Admin->>ProxyAdmin: upgradeAndCall(proxy, newImpl, data)
    ProxyAdmin->>TransparentProxy: upgradeToAndCall(newImpl, data)
    TransparentProxy->>TransparentProxy: _dispatchUpgradeToAndCall()
    TransparentProxy->>NewImplementation: delegatecall(data) [if data provided]
"
/>

## User Flow

Regular users can call any function except upgrade functions, which are delegated to the implementation contract.

<Mermaid
  chart="
sequenceDiagram
    participant User
    participant TransparentProxy
    participant Implementation

    User->>TransparentProxy: call someFunction()
    Note over TransparentProxy: msg.sender != admin
    TransparentProxy->>Implementation: delegatecall(someFunction())
    Implementation-->>TransparentProxy: return result
    TransparentProxy-->>User: return result
"
/>
